---
title: "nuxt3 + firebaseã‚’è©¦ã—ã¦ã¿ã‚‹"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nuxt", "firebase"]
published: false
---

# ç›®æ¨™

nuxt3 ã‚’ä½¿ã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ firestore + auth ã‚’ç”¨ã„ãŸã‚‚ã®ã‚’ä½œã‚‹

# nuxt3 é–¢é€£ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨å‹•ä½œç¢ºèª

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨å‹•ä½œç¢ºèª

```
$ npx nuxi init nuxt3-firebase-test
$ cd nuxt3-firebase-test
$ npm run dev
```

`http://localhost:3000/`ã«ã‚¢ã‚¯ã‚»ã‚¹

## åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### pages ã®ã¿ã§ã®é‹ç”¨ã«åˆ‡ã‚Šæ›¿ãˆã‚‹

`app.vue`ã‚’å‰Šé™¤ã—ã¦`pages/index.vue`ã®ä½œæˆ

```vue:pages/index.vue
<template>
    <div>
        <p>hello</p>
    </div>
</template>
```

```
$ npm run dev
```

å†åº¦èµ·å‹•ã—ã€å‹•ä½œç¢ºèª

### eslint ç­‰ã®è¨­å®š

nuxt3 ã§ã¯ eslint ã®è¨­å®šãŒ CLI ã§è¡Œãˆãªã„ã®ã§æ‰‹å‹•ã§è¡Œã†ã€‚

```json:package.json
{
  "private": true,
  "scripts": {
    "dev": "nuxi dev",
    "build": "nuxi build",
    "start": "node .output/server/index.mjs"
  },
  "devDependencies": {
    "@nuxtjs/eslint-config": "^7.0.0",
    "@nuxtjs/eslint-module": "^3.0.2",
    "@typescript-eslint/eslint-plugin": "^5.7.0",
    "@typescript-eslint/parser": "^5.7.0",
    "eslint": "^8.4.1",
    "eslint-config-prettier": "^8.3.0",
    "eslint-plugin-nuxt": "^3.0.0",
    "eslint-plugin-prettier": "^4.0.0",
    "eslint-plugin-vue": "^8.2.0",
    "nuxt3": "latest",
    "prettier": "^2.5.1",
    "typescript": "^4.5.4",
    "typescript-eslint": "^0.0.1-alpha.0"
  }
}
```

```js:.eslintrc.js
module.exports = {
    env: {
        browser: true,
        es2021: true,
    },
    extends: [
        'plugin:vue/vue3-recommended',
        'prettier',
        'plugin:@typescript-eslint/recommended',
        'plugin:nuxt/recommended',
    ],
    parserOptions: {
        ecmaVersion: 13,
        parser: '@typescript-eslint/parser',
        sourceType: 'module',
    },
    plugins: ['vue', '@typescript-eslint', '@typescript-eslint/eslint-plugin'],
    rules: {
        'no-unused-vars': 'off',
    },
};
```

```js:.prettierrc.js
module.exports = {
    trailingComma: 'es5',
    tabWidth: 4,
    semi: true,
    singleQuote: true,
};
```

```
$ npm install
```

ä¸Šè¨˜ã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèª

### TypeScript ã® Strict type checks ã‚’æœ‰åŠ¹ã«ã™ã‚‹

```ts:nuxt.config.ts
import { defineNuxtConfig } from 'nuxt3'

export default defineNuxtConfig({
  typescript: {
    strict: true
  }
})
```

## API Routes ã®å‹•ä½œç¢ºèª

```ts:/server/api/hello.ts
export interface Hello {
    msg: string;
}

export default () => {
    return {
        msg: 'Hello World',
    };
};
```

```vue:pages/index.vue
<script setup lang="ts">
const { data: test } = useFetch('/api/hello');
</script>

<template>
    <div>
        <p>{{ test }}</p>
    </div>
</template>
```

```
{ "msg": "Hello World" }
```

# firebase ã®è¨­å®š

## firebase init

ãã®ã†ã¡å®Œå…¨ç§»è¡Œã™ã‚‹ã‚‰ã—ã„ã®ã§ã€firebase v9 ã‚’ä½¿ã£ã¦ã„ã

nuxt ã§ firebase ã‚’ä½¿ã†å ´åˆ`@nuxtjs/firebase` ã‚’ä½¿ãˆã‚‹ãŒ ã€ãƒªãƒã‚¸ãƒˆãƒªã® readme ã«ã‚ã‚‹ã‚ˆã†ã« firebase v9 ã¯å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ä»Šå›ã¯æ‰‹å‹•ã§å®Ÿè£…ã™ã‚‹ã€‚

> This module does not support the new modular syntax from Firebase v9+.

https://github.com/nuxt-community/firebase-module

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm install --save firebase
```

```
firebase init
```

## firestore ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

### firebase ã®åˆæœŸåŒ–å‡¦ç†

```:.env
API_KEY=
AUTH_DOMAIN=
PROJECT_ID=
STORAGE_BUCKET=
MESSAGING_SENDER_ID=
APP_ID=
MEASUREMENT_ID=
```

```ts:composables/firebaseInit.ts
import { initializeApp } from 'firebase/app';

const firebaseConfig = {
    apiKey: process.env.API_KEY,
    authDomain: process.env.AUTH_DOMAIN,
    projectId: process.env.PROJECT_ID,
    storageBucket: process.env.STORAGE_BUCKET,
    messagingSenderId: process.env.MESSAGING_SENDER_ID,
    appId: process.env.APP_ID,
    measurementId: process.env.MEASUREMENT_ID,
};

const firebase = initializeApp(firebaseConfig);

export default firebase;
```

### composables ã«ã‚¢ã‚¯ã‚»ã‚¹éƒ¨åˆ†ã‚’å®Ÿè£…ã™ã‚‹

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³`tasks`ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã‚ˆã—ãªã«ä½œã£ã¦ãã ã•ã„
ãƒ­ã‚°ã‚¤ãƒ³ã¯ãƒ„ã‚¤ãƒƒã‚¿ãƒ¼ãƒ­ã‚°ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚
ã“ã“ã§ã¯èª¬æ˜ã—ã¾ã›ã‚“ã€‚

```ts:composables/useFirestore.ts
import {
    getFirestore,
    collection,
    query,
    where,
    getDocs,
} from 'firebase/firestore';

import { firebaseInit } from './firebaseInit';

export const useFirestore = () => {
    const db = getFirestore(firebaseInit());

    const GetArticles = async () => {
        const q = query(
            collection(db, 'articles'),
            where('UserID', '==', 'testman999')
        );
        const querySnapshot = await getDocs(q);

        querySnapshot.forEach((doc) => {
            console.log(doc.data());
        });
    };
    return {
        GetArticles,
    };
};
```

```ts:useAuth.ts
import {
    getAuth,
    signInWithPopup,
    TwitterAuthProvider,
    OAuthCredential,
    UserCredential,
} from 'firebase/auth';

export const useAuth = () => {
    const loginWithTwitter = () => {
        const router = useRouter();
        const auth = getAuth();
        const provider = new TwitterAuthProvider();
        signInWithPopup(auth, provider)
            .then((result) => {
                const credential: OAuthCredential | null =
                    TwitterAuthProvider.credentialFromResult(result);
                console.log(result);
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                const email = error.email;
                const credential =
                    TwitterAuthProvider.credentialFromError(error);
                console.log(4, errorCode);
                console.log(5, errorMessage);
                console.log(6, email);
                console.log(7, credential);
            });
    };

    return {
        loginWithTwitter,
    };
};
```

```vue:index.vue
<script setup lang="ts">
const { getArticles } = useFirestore();
const { userInfo, loginWithTwitter } = useAuth();
</script>

<template>
    <div>
        <p @click="getArticles">GetArticles</p>
        <p @click="loginWithTwitter">loginWithTwitter</p>
    </div>
</template>
```

å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚

# çµ‚ã‚ã‚Šã«

nuxt2 ã¨æ¯”ã¹ã‹ãªã‚Šç°¡æ½”ãªæ›¸ãæ–¹ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ä»Šå› ts ã‚’åˆä½¿ç”¨ã®ãŸã‚ã€ãƒ™ã‚¹ãƒˆãªæ›¸ãæ–¹ã§ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€ãœã²æŒ‡æ‘˜ã—ã¦ã„ãŸã ããŸã„ã§ã™ã€‚
