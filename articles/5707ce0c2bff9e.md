---
title: "nuxt3 + firebase v9(Firestore, Authentication) ã‚’è©¦ã—ã¦ã¿ã‚‹ã€‚"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nuxtjs", "nuxt3", "firebase", "TypeScript", "vue", "Vue3"]
published: true
---

:::message
åŸ·ç­†æ™‚(`2021/12/20`)ã§ Nuxt3 ã¯ Public Beta ã§ã™ã€‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã£ã¦ã“ã®è¨˜äº‹ã®ã‚³ãƒ¼ãƒ‰ç­‰ãŒæ­£ã—ããªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

typesprict ã‚’ä½¿ã†ã®ãŒä»Šå›ãŒåˆãªã®ã§ã€æ­£ã—ããªã„æ›¸ãæ–¹ã‚’ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
:::

# ã¯ã˜ã‚ã«

Nuxt3 ãŒç™ºè¡¨ã•ã‚Œã¦ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã®é–‹ç™ºã§ Nuxt2 ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§è©¦ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
åŒã˜ãæœ€è¿‘ firebase ã® v9 ãŒç™ºè¡¨ã•ã‚Œã¦ã€ç§»è¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‰ã—ã„ã®ã§ã€ã¤ã„ã§ã«ã“ã¡ã‚‰ã‚‚è©¦ã—ã¦ã„ãã¾ã™ã€‚

## ç›®æ¨™

- Nuxt3 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
- Firebase ã® Cloud Firestore ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
- Firebase Authentication ã‚’ç”¨ã„ãŸ Twitter ãƒ­ã‚°ã‚¤ãƒ³ã®å®Ÿè£…

## å‰æ

- Firestore ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³(`articles`)ã®ä½œæˆã¨ã€åˆæœŸãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥
- Authentication ã¯ Twitter ã‚’ä½¿ç”¨ã—ãŸã‚‚ã®ã‚’å®Ÿè£…ã™ã‚‹äºˆå®šã§ã™ãŒã€ãã®åˆæœŸè¨­å®š

ä»¥ä¸Šã® 2 ã¤ã«é–¢ã—ã¦ã¯ä»Šå›ã¯èª¬æ˜ã‚’çœã‹ã›ã¦ã„ãŸã ãã¾ã™ã€‚

# nuxt3 é–¢é€£ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨å‹•ä½œç¢ºèª

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨å‹•ä½œç¢ºèª

```
$ npx nuxi init nuxt3-firebase-test
$ cd nuxt3-firebase-test
$ npm run dev
```

`http://localhost:3000/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### pages ã®ã¿ã§ã®é‹ç”¨ã«åˆ‡ã‚Šæ›¿ãˆã‚‹

`app.vue`ã‚’å‰Šé™¤ã—ã¦`pages/index.vue`ã®ä½œæˆã—ã¾ã™ã€‚

```vue:pages/index.vue
<template>
    <div>
        <p>hello</p>
    </div>
</template>
```

```
$ npm run dev
```

å†åº¦èµ·å‹•ã—ã€`http://localhost:3000/`ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

### eslint ç­‰ã®è¨­å®š

nuxt3 ã§ã¯ eslint ã®è¨­å®šãŒ CLI ã§è¡Œãˆãªã„ã®ã§æ‰‹å‹•ã§è¡Œã£ã¦ã„ãã¾ã™ã€‚

```json:package.json
{
  "private": true,
  "scripts": {
    "dev": "nuxi dev",
    "build": "nuxi build",
    "start": "node .output/server/index.mjs"
  },
  "devDependencies": {
    "@nuxtjs/eslint-config": "^7.0.0",
    "@nuxtjs/eslint-module": "^3.0.2",
    "@typescript-eslint/eslint-plugin": "^5.7.0",
    "@typescript-eslint/parser": "^5.7.0",
    "eslint": "^8.4.1",
    "eslint-config-prettier": "^8.3.0",
    "eslint-plugin-nuxt": "^3.0.0",
    "eslint-plugin-prettier": "^4.0.0",
    "eslint-plugin-vue": "^8.2.0",
    "nuxt3": "latest",
    "prettier": "^2.5.1",
    "typescript": "^4.5.4",
    "typescript-eslint": "^0.0.1-alpha.0"
  }
}
```

```js:.eslintrc.js
module.exports = {
    env: {
        browser: true,
        es2021: true,
    },
    extends: [
        'plugin:vue/vue3-recommended',
        'prettier',
        'plugin:@typescript-eslint/recommended',
        'plugin:nuxt/recommended',
    ],
    parserOptions: {
        ecmaVersion: 13,
        parser: '@typescript-eslint/parser',
        sourceType: 'module',
    },
    plugins: ['vue', '@typescript-eslint', '@typescript-eslint/eslint-plugin'],
    rules: {
        'no-unused-vars': 'off',
    },
};
```

```js:.prettierrc.js
module.exports = {
    trailingComma: 'es5',
    tabWidth: 4,
    semi: true,
    singleQuote: true,
};
```

```
$ npm install
```

ä¸Šè¨˜ã‚’å®Ÿè¡Œã—ã¦å®Œäº†ã§ã™ã€‚

### TypeScript ã® Strict type checks ã‚’æœ‰åŠ¹ã«ã™ã‚‹

> åˆã‚ã‹ã‚‰ TypeScript ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã¯å¬‰ã—ã„ã®ã§ã™ãŒã€ãªãœã ã‹ Strict type checks ï¼ˆå³æ ¼ãƒ¢ãƒ¼ãƒ‰)ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ãªã„ã§ã™ã€‚ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã¯ Strict type checks ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚Œã° noImplicitAny ã«ã‚ˆã‚Šã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã—ã¦ãã‚Œã‚‹ã¯ãšãªã®ã§ã™ãŒã€ç¾çŠ¶ã®è¨­å®šã§ã¯ãã†ã¯ãªã£ã¦ãã‚Œã¾ã›ã‚“ã€‚

å‚è€ƒ:[Nuxt3 ã®æ–°ã—ã„æ©Ÿèƒ½ - TypeScript ã® Strict type checks ã‚’æœ‰åŠ¹ã«ã™ã‚‹](https://zenn.dev/azukiazusa/articles/nuxt3-new-features#typescript-%E3%81%AE-strict-type-checks-%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B)

```ts:nuxt.config.ts
import { defineNuxtConfig } from 'nuxt3'

export default defineNuxtConfig({
  typescript: {
    strict: true
  }
})
```

### SSR å¯¾å¿œ

> ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ SSR ã§ã¯ãªã SPA ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€nuxt.config.ts ã§ SSR ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ true ã«ã—ã¾ã™ã€‚

å‚è€ƒ:[Nuxt 3 ã‚’ Google App Engine æœ¬ç•ªç’°å¢ƒ ã§ SSR + ã‚­ãƒ£ãƒƒã‚·ãƒ¥é‹ç”¨ã—ã¦ã¿ã‚‹ - SSR å¯¾å¿œ](https://zenn.dev/ytr0903/articles/81c8bed9a60702#ssr%E5%AF%BE%E5%BF%9C)

```ts:nuxt.config.ts
import { defineNuxtConfig } from 'nuxt3'

export default defineNuxtConfig({
  typescript: {
    strict: true
  },
  ssr: true,
})
```

# firebase ã®è¨­å®š

## firebase init

nuxt ã§ firebase ã‚’ä½¿ã†å ´åˆ`@nuxtjs/firebase` ã‚’ä½¿ãˆã‚‹ãŒ ã€ãƒªãƒã‚¸ãƒˆãƒªã® `README` ã«ã‚ã‚‹ã‚ˆã†ã« firebase v9 ã¯å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ä»Šå›ã¯æ‰‹å‹•ã§å®Ÿè£…ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

> This module does not support the new modular syntax from Firebase v9+.

https://github.com/nuxt-community/firebase-module

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm install --save firebase
```

```
firebase init
```

## firestore ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

### firebase ã®åˆæœŸåŒ–å‡¦ç†

```ts:composables/firebaseInit.ts
import { initializeApp } from 'firebase/app';

const firebaseConfig = {
    apiKey: [API_KEY],
    authDomain: [AUTH_DOMAIN],
    projectId: [PROJECT_ID],
    storageBucket: process.env.[STORAGE_BUCKET],
    messagingSenderId: [MESSAGING_SENDER_ID],
    appId: [APP_ID],
    measurementId: [MEASUREMENT_ID],
};

const firebase = initializeApp(firebaseConfig);

export default firebase;
```

### composables ã«ã‚¢ã‚¯ã‚»ã‚¹éƒ¨åˆ†ã‚’å®Ÿè£…ã™ã‚‹

ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³`articles`ã¨ãã®ä¸­ã®ãƒ‡ãƒ¼ã‚¿ã¯ firebase ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã‚ˆã—ãªã«ä½œã£ã¦ãŠã„ã¦ãã ã•ã„ã€‚

```ts:composables/useFirestore.ts
import {
    getFirestore,
    collection,
    query,
    where,
    getDocs,
} from 'firebase/firestore';

import { firebaseInit } from './firebaseInit';

export const useFirestore = () => {
    const db = getFirestore(firebaseInit());

    const GetArticles = async () => {
        const q = query(
            collection(db, 'articles'),
        );
        const querySnapshot = await getDocs(q);

        querySnapshot.forEach((doc) => {
            console.log(doc.data());
        });
    };
    return {
        GetArticles,
    };
};
```

```ts:useAuth.ts
import {
    getAuth,
    signInWithPopup,
    TwitterAuthProvider,
    OAuthCredential,
    UserCredential,
} from 'firebase/auth';

export const useAuth = () => {
    const loginWithTwitter = async () => {
        const auth = getAuth();
        const provider = new TwitterAuthProvider();
        const result = await signInWithPopup(auth, provider).catch((error) => {
            const credential = TwitterAuthProvider.credentialFromError(error);
            console.log(error, credential);
        });
        const credential =
            result != null
                ? await TwitterAuthProvider.credentialFromResult(result)
                : null;
        if (result != null && credential != null) {
            console.log(result, credential);
        }
    };

    return {
        loginWithTwitter,
    };
};
```

```vue:index.vue
<script setup lang="ts">
const { getArticles } = useFirestore();
const { userInfo, loginWithTwitter } = useAuth();
</script>

<template>
    <div>
        <p @click="getArticles">GetArticles</p>
        <p @click="loginWithTwitter">loginWithTwitter</p>
    </div>
</template>
```

å„ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚

# çµ‚ã‚ã‚Šã«

nuxt2 ã¨æ¯”ã¹ã€è‡ªå‹• import ãŒåŠ¹ã„ã¦ã„ã‚‹åˆ†ã€ã‹ãªã‚Šç°¡æ½”ãªæ›¸ãæ–¹ã«ã™ã‚‹ã“ã¨ãŒã§ããŸã¨æ€ã„ã¾ã™ã€‚

ä»Šå›ãŒ typescript ã‚’åˆä½¿ç”¨ã®ãŸã‚ã€ãƒ™ã‚¹ãƒˆãªæ›¸ãæ–¹ãŒã§ãã¦ã„ãªã„ã¨æ€ã„ã¾ã™ã®ã§æ˜¯éã‚³ãƒ¡ãƒ³ãƒˆç­‰ã«ã¦ã€æŒ‡æ‘˜ã—ã¦ã„ãŸã ããŸã„ã§ã™ã€‚
