---
title: "nuxt3 + firebaseã‚’è©¦ã—ã¦ã¿ã‚‹"
emoji: "ğŸ“"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nuxt", "firebase"]
published: false
---

# ç›®æ¨™

nuxt3 ã‚’ä½¿ã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ firestore + auth ã‚’ç”¨ã„ãŸã‚‚ã®ã‚’ä½œã‚‹

# nuxt3 é–¢é€£ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¨å‹•ä½œç¢ºèª

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆã¨å‹•ä½œç¢ºèª

```
$ npx nuxi init nuxt3-firebase-test
$ cd nuxt3-firebase-test
$ npm run dev
```

`http://localhost:3000/`ã«ã‚¢ã‚¯ã‚»ã‚¹

## åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### pages ã®ã¿ã§ã®é‹ç”¨ã«åˆ‡ã‚Šæ›¿ãˆã‚‹

`app.vue`ã‚’å‰Šé™¤ã—ã¦`pages/index.vue`ã®ä½œæˆ

```vue:pages/index.vue
<template>
    <div>
        <p>hello</p>
    </div>
</template>
```

```
$ npm run dev
```

å†åº¦èµ·å‹•ã—ã€å‹•ä½œç¢ºèª

### eslint ç­‰ã®è¨­å®š

nuxt3 ã§ã¯ eslint ã®è¨­å®šãŒ CLI ã§è¡Œãˆãªã„ã®ã§æ‰‹å‹•ã§è¡Œã†ã€‚

```json:package.json
{
  "private": true,
  "scripts": {
    "dev": "nuxi dev",
    "build": "nuxi build",
    "start": "node .output/server/index.mjs"
  },
  "devDependencies": {
    "@nuxtjs/eslint-config": "^7.0.0",
    "@nuxtjs/eslint-module": "^3.0.2",
    "@typescript-eslint/eslint-plugin": "^5.7.0",
    "@typescript-eslint/parser": "^5.7.0",
    "eslint": "^8.4.1",
    "eslint-config-prettier": "^8.3.0",
    "eslint-plugin-nuxt": "^3.0.0",
    "eslint-plugin-prettier": "^4.0.0",
    "eslint-plugin-vue": "^8.2.0",
    "nuxt3": "latest",
    "prettier": "^2.5.1",
    "typescript": "^4.5.4",
    "typescript-eslint": "^0.0.1-alpha.0"
  }
}
```

```js:.eslintrc.js
module.exports = {
    env: {
        browser: true,
        es2021: true,
    },
    extends: [
        'plugin:vue/vue3-recommended',
        'prettier',
        'plugin:@typescript-eslint/recommended',
        'plugin:nuxt/recommended',
    ],
    parserOptions: {
        ecmaVersion: 13,
        parser: '@typescript-eslint/parser',
        sourceType: 'module',
    },
    plugins: ['vue', '@typescript-eslint', '@typescript-eslint/eslint-plugin'],
    rules: {
        'no-unused-vars': 'off',
    },
};
```

```js:.prettierrc.js
module.exports = {
    trailingComma: 'es5',
    tabWidth: 4,
    semi: true,
    singleQuote: true,
};
```

```
$ npm install
```

ä¸Šè¨˜ã‚’å®Ÿè¡Œã—ã¦å‹•ä½œç¢ºèª

### TypeScript ã® Strict type checks ã‚’æœ‰åŠ¹ã«ã™ã‚‹

```ts:nuxt.config.ts
import { defineNuxtConfig } from 'nuxt3'

export default defineNuxtConfig({
  typescript: {
    strict: true
  }
})
```

## API Routes ã®å‹•ä½œç¢ºèª

```ts:/server/api/hello.ts
export interface Hello {
    msg: string;
}

export default () => {
    return {
        msg: 'Hello World',
    };
};
```

```vue:pages/index.vue
<script setup lang="ts">
const { data: test } = useFetch('/api/hello');
</script>

<template>
    <div>
        <p>{{ test }}</p>
    </div>
</template>
```

```
{ "msg": "Hello World" }
```

# firebase ã®è¨­å®š

## firebase init

ãã®ã†ã¡å®Œå…¨ç§»è¡Œã™ã‚‹ã‚‰ã—ã„ã®ã§ã€firebase v9 ã‚’ä½¿ã£ã¦ã„ã

nuxt ã§ firebase ã‚’ä½¿ã†å ´åˆ`@nuxtjs/firebase` ã‚’ä½¿ãˆã‚‹ãŒ ã€ãƒªãƒã‚¸ãƒˆãƒªã® readme ã«ã‚ã‚‹ã‚ˆã†ã« firebase v9 ã¯å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ä»Šå›ã¯æ‰‹å‹•ã§å®Ÿè£…ã™ã‚‹ã€‚

> This module does not support the new modular syntax from Firebase v9+.

https://github.com/nuxt-community/firebase-module

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm install --save firebase
```

```
firebase init
```

## firestore ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

### firebase ã®åˆæœŸåŒ–å‡¦ç†

plugins ã« firebase ã®åˆæœŸåŒ–å‡¦ç†ã‚’å…¥ã‚Œã‚‹ã®ã¯ã„ã„ã®ã‹ã‚ã‹ã‚‰ã‚“ã‘ã©å…¥ã‚Œã¦ã‚‹(è¦ç¢ºèª)

```:.env
API_KEY=
AUTH_DOMAIN=
PROJECT_ID=
STORAGE_BUCKET=
MESSAGING_SENDER_ID=
APP_ID=
MEASUREMENT_ID=
```

```ts:plugins/firebase.ts
import { initializeApp } from 'firebase/app';

const firebaseConfig = {
    apiKey: process.env.API_KEY,
    authDomain: process.env.AUTH_DOMAIN,
    projectId: process.env.PROJECT_ID,
    storageBucket: process.env.STORAGE_BUCKET,
    messagingSenderId: process.env.MESSAGING_SENDER_ID,
    appId: process.env.APP_ID,
    measurementId: process.env.MEASUREMENT_ID,
};

const firebase = initializeApp(firebaseConfig);

export default firebase;
```

### server/api ã«ã‚¢ã‚¯ã‚»ã‚¹éƒ¨åˆ†ã‚’å®Ÿè£…ã™ã‚‹

/api/ã®ãƒ•ã‚¡ã‚¤ãƒ«åã¯å°æ–‡å­—ã˜ã‚ƒãªã„ã¨ useFeach ã§ããªã„ã®ã§æ³¨æ„
ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³`tasks`ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ä¸Šã§ã‚ˆã—ãªã«ä½œã£ã¦ãã ã•ã„

```ts:server/api/gettest.ts
import { getFirestore, collection, query, getDocs } from 'firebase/firestore';
import firebase from '../../plugins/firebase';

export interface Tasks {
    id: string;
    name: string;
}

export default async () => {
    const db = getFirestore(firebase);
    const q = query(collection(db, 'tasks'));
    const querySnapshot = await getDocs(q);

    // let tasks: Tasks[];
    const tasks: Tasks[] = [];

    querySnapshot.forEach((doc) => {
        console.log(doc.data());
        const task: Tasks = {
            id: doc.data().id,
            name: doc.data().name,
        };
        tasks.push(task);
    });

    return tasks;
};
```

```vue:index.vue
<script setup lang="ts">
const { data: tasks } = await useFetch('/api/gettest');
</script>

<template>
    <div>
        <p>test</p>
        <div v-for="task in data" :key="task.id">
            <p>{{ task.id }}</p>
            <p>{{ task.name }}</p>
        </div>
    </div>
</template>
```
